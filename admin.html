<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¯¸íŒ… ë°°ì • ì‹œìŠ¤í…œ - ê´€ë¦¬ì</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Malgun Gothic','ë§‘ì€ ê³ ë”•',Apple SD Gothic Neo,sans-serif;background:#EEF2F7;color:#222;min-height:100vh;font-size:14px}
.page{display:none}.page.active{display:block}
:root{--navy:#1B3A6B;--blue:#2E75B6;--sky:#EBF3FB;--green:#27AE60;--green-light:#E8F8EF;--orange:#E67E22;--orange-light:#FEF3E2;--red:#E74C3C;--red-light:#FDECEA;--yellow:#F39C12;--gray:#6C757D;--gray-light:#F4F6F8;--border:#DDE3EA;--shadow:0 2px 12px rgba(0,0,0,.08);--shadow-lg:0 8px 32px rgba(0,0,0,.12)}

/* ë¡œê·¸ì¸ */
#page-login{min-height:100vh;background:linear-gradient(135deg,#0D2040 0%,#1B3A6B 50%,#2E75B6 100%);display:none;align-items:center;justify-content:center;padding:20px}
#page-login.active{display:flex}
.auth-box{background:#fff;border-radius:20px;padding:48px 40px;width:100%;max-width:420px;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.auth-logo{text-align:center;margin-bottom:32px}
.auth-logo .icon{width:64px;height:64px;background:var(--navy);border-radius:16px;display:inline-flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:12px}
.auth-logo h1{font-size:20px;font-weight:700;color:var(--navy)}
.auth-logo p{font-size:12px;color:var(--gray);margin-top:4px}
.form-g{margin-bottom:18px}
.form-g label{display:block;font-size:13px;font-weight:600;color:#444;margin-bottom:6px}
.form-g input{width:100%;border:1.5px solid var(--border);border-radius:10px;padding:12px 16px;font-size:14px;font-family:inherit;transition:border-color .2s;outline:none;background:#FAFBFC}
.form-g input:focus{border-color:var(--blue);background:#fff}
.btn-primary{width:100%;background:var(--navy);color:#fff;border:none;padding:14px;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;transition:background .2s}
.btn-primary:hover{background:var(--blue)}
.auth-err{background:#FDECEA;color:var(--red);padding:10px 14px;border-radius:8px;font-size:13px;margin-bottom:14px;display:none}

/* ë ˆì´ì•„ì›ƒ */
.layout{display:flex;min-height:calc(100vh - 0px)}
.sidebar{width:220px;background:var(--navy);min-height:100vh;position:fixed;top:0;left:0;z-index:100;display:flex;flex-direction:column}
.sidebar-brand{padding:20px;border-bottom:1px solid rgba(255,255,255,.1)}
.sidebar-brand h2{font-size:15px;font-weight:700;color:#fff;margin-bottom:2px}
.sidebar-brand p{font-size:11px;color:#90CAF9}
.sidebar-nav{flex:1;padding:12px 0}
.nav-item{display:flex;align-items:center;gap:10px;padding:12px 20px;color:#B0C4DE;cursor:pointer;transition:all .2s;font-size:13px;font-weight:500;border-left:3px solid transparent}
.nav-item:hover{background:rgba(255,255,255,.08);color:#fff}
.nav-item.active{background:rgba(46,117,182,.3);color:#fff;border-left-color:#5B9BD5}
.nav-item .icon{font-size:16px;width:20px;text-align:center}
.sidebar-bottom{padding:16px;border-top:1px solid rgba(255,255,255,.1)}
.sidebar-user{font-size:12px;color:#90CAF9;margin-bottom:10px}
.btn-logout{width:100%;background:rgba(255,255,255,.1);border:none;color:#fff;padding:9px;border-radius:8px;cursor:pointer;font-size:13px;font-family:inherit}
.btn-logout:hover{background:rgba(255,255,255,.2)}
.main-area{margin-left:220px;min-height:100vh}
.topbar{background:#fff;padding:0 24px;height:52px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);box-shadow:0 1px 4px rgba(0,0,0,.05)}
.topbar-title{font-size:16px;font-weight:700;color:var(--navy)}
.content{padding:24px;max-width:1100px}

/* íƒ­ ë·° */
.view{display:none}.view.active{display:block}

/* ê³µí†µ */
.card{background:#fff;border-radius:14px;padding:20px;margin-bottom:16px;box-shadow:var(--shadow)}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px}
.card-title{font-size:15px;font-weight:700;color:var(--navy)}
.badge{display:inline-block;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;white-space:nowrap}
.badge-open{background:#E8F4FD;color:#1565C0}
.badge-pending{background:var(--orange-light);color:var(--orange)}
.badge-assigned{background:var(--green-light);color:var(--green)}
.badge-precall{background:#E3F2FD;color:#0288D1}
.badge-done{background:#F3E5F5;color:#7B1FA2}
.badge-cancelled{background:#F5F5F5;color:#9E9E9E}
.badge-warn{background:var(--orange-light);color:var(--orange)}
.btn{border:none;padding:9px 18px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.btn-blue{background:var(--blue);color:#fff}.btn-blue:hover{background:#1F5A9A}
.btn-green{background:var(--green);color:#fff}.btn-green:hover{background:#219A52}
.btn-orange{background:var(--orange);color:#fff}.btn-orange:hover{background:#CA6F1E}
.btn-red{background:var(--red);color:#fff}.btn-red:hover{background:#C0392B}
.btn-outline{background:transparent;color:var(--blue);border:1.5px solid var(--blue)}.btn-outline:hover{background:var(--sky)}
.btn-ghost{background:var(--gray-light);color:#444;border:1px solid var(--border)}.btn-ghost:hover{background:var(--border)}
.btn-sm{padding:6px 12px;font-size:12px}
.form-row{margin-bottom:14px}
.form-row label{display:block;font-size:12px;font-weight:700;color:#555;margin-bottom:5px}
.form-row label .req{color:var(--red);margin-left:3px}
.fc{width:100%;border:1.5px solid var(--border);border-radius:8px;padding:9px 13px;font-size:13px;font-family:inherit;outline:none;transition:border-color .2s;background:#FAFBFC}
.fc:focus{border-color:var(--blue);background:#fff}
select.fc{cursor:pointer}
textarea.fc{resize:vertical;min-height:72px}
.tbl{width:100%;border-collapse:collapse}
.tbl th{background:#F4F6F8;font-size:12px;font-weight:700;color:var(--gray);padding:10px 14px;text-align:left;border-bottom:2px solid var(--border);white-space:nowrap}
.tbl td{padding:11px 14px;border-bottom:1px solid #F0F0F0;font-size:13px;vertical-align:middle}
.tbl tr:hover td{background:#FAFBFC}
.tbl .action-btns{display:flex;gap:6px}
.filter-bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:16px;padding:14px 16px;background:#fff;border-radius:10px;box-shadow:var(--shadow)}
.filter-bar select,.filter-bar input{border:1.5px solid var(--border);border-radius:8px;padding:8px 12px;font-size:13px;font-family:inherit;outline:none;background:#fff}
.filter-bar select:focus,.filter-bar input:focus{border-color:var(--blue)}
.empty-state{text-align:center;padding:40px 20px;color:var(--gray)}
.empty-state .icon{font-size:40px;margin-bottom:10px}
.loading{text-align:center;padding:32px;color:var(--gray);font-size:13px}
.spinner{display:inline-block;width:20px;height:20px;border:3px solid var(--border);border-top-color:var(--blue);border-radius:50%;animation:spin .8s linear infinite;vertical-align:middle;margin-right:8px}
@keyframes spin{to{transform:rotate(360deg)}}
#toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#323232;color:#fff;padding:12px 24px;border-radius:10px;font-size:14px;z-index:9999;opacity:0;transition:opacity .3s;max-width:90%;text-align:center;pointer-events:none}
#toast.show{opacity:1}
#toast.success{background:#1B5E20}
#toast.error{background:#B71C1C}

/* ëŒ€ì‹œë³´ë“œ í†µê³„ */
.stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:16px}
@media(max-width:900px){.stat-grid{grid-template-columns:repeat(2,1fr)}}
.stat-card{background:#fff;border-radius:14px;padding:18px 16px;box-shadow:var(--shadow);border-top:4px solid var(--blue)}
.stat-card.orange{border-top-color:var(--orange)}
.stat-card.red{border-top-color:var(--red)}
.stat-card.green{border-top-color:var(--green)}
.stat-card.yellow{border-top-color:var(--yellow)}
.stat-card .num{font-size:32px;font-weight:800;color:var(--navy);line-height:1}
.stat-card .lbl{font-size:12px;color:var(--gray);margin-top:6px}
.stat-card .sub{font-size:11px;color:var(--gray);margin-top:4px}

/* ì‹ ì²­ì ëª©ë¡ (í™•ì • í™”ë©´) */
.applicant-item{border:1.5px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between;gap:12px;transition:border-color .2s}
.applicant-item:hover{border-color:var(--blue)}
.applicant-item.assigned{border-color:var(--green);background:var(--green-light)}
.applicant-item.reserve{background:#F9F9F9}
.ai-left{display:flex;align-items:center;gap:12px}
.ai-no{width:32px;height:32px;border-radius:50%;background:var(--blue);color:#fff;font-size:13px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ai-no.reserve{background:#B0BEC5}
.ai-name{font-size:14px;font-weight:700;color:var(--navy)}
.ai-time{font-size:12px;color:var(--gray)}
.ai-warn{font-size:11px;color:var(--orange);font-weight:600;margin-top:2px}

/* ë¡œê·¸ íƒ€ì„ë¼ì¸ */
.log-item{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid #F0F0F0}
.log-item:last-child{border-bottom:none}
.log-time{font-size:11px;color:var(--gray);white-space:nowrap;min-width:140px}
.log-actor{font-size:12px;font-weight:600;color:var(--navy)}
.log-msg{font-size:12px;color:#555}

/* ëª¨ë‹¬ */
.modal-ov{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:500;display:none;align-items:center;justify-content:center;padding:16px}
.modal-ov.open{display:flex}
.modal{background:#fff;border-radius:16px;padding:28px;width:100%;max-width:560px;max-height:92vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.modal.wide{max-width:760px}
.modal-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.modal-title{font-size:17px;font-weight:700;color:var(--navy)}
.modal-close{background:none;border:none;font-size:22px;cursor:pointer;color:var(--gray);line-height:1;padding:4px}
.modal-ft{margin-top:20px;display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}
.section-title{font-size:13px;font-weight:700;color:var(--gray);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);text-transform:uppercase;letter-spacing:.5px}
.detail-row{display:flex;gap:8px;margin-bottom:6px;font-size:13px}
.detail-lbl{color:var(--gray);min-width:80px;flex-shrink:0}
.detail-val{color:#222;font-weight:500}

@media(max-width:768px){
  .sidebar{width:200px}
  .main-area{margin-left:200px}
  .content{padding:16px}
  .stat-grid{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:600px){
  .sidebar{transform:translateX(-100%);transition:transform .3s}
  .sidebar.open{transform:translateX(0)}
  .main-area{margin-left:0}
}
</style>
</head>
<body>
<div id="toast"></div>

<!-- â‘  ë¡œê·¸ì¸ -->
<div id="page-login" class="page">
  <div class="auth-box">
    <div class="auth-logo">
      <div class="icon">ğŸ›¡ï¸</div>
      <h1>ë¯¸íŒ… ë°°ì • ì‹œìŠ¤í…œ</h1>
      <p>ê´€ë¦¬ì ì „ìš© í˜ì´ì§€</p>
    </div>
    <div class="auth-err" id="login-err"></div>
    <div class="form-g"><label>ì•„ì´ë””</label><input type="text" id="inp-id" placeholder="ê´€ë¦¬ì ì•„ì´ë””" autocomplete="username"></div>
    <div class="form-g"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="inp-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" autocomplete="current-password"></div>
    <button class="btn-primary" id="btn-login" onclick="doLogin()">ë¡œê·¸ì¸</button>
  </div>
</div>

<!-- â‘¡ ë©”ì¸ -->
<div id="page-main" class="page">
  <div class="layout">
    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="sidebar">
      <div class="sidebar-brand">
        <h2>ğŸ›¡ï¸ ë¯¸íŒ… ë°°ì • ì‹œìŠ¤í…œ</h2>
        <p>ê´€ë¦¬ì ì½˜ì†”</p>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-item active" onclick="showView('v-dash')" id="ni-dash"><span class="icon">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ</div>
        <div class="nav-item" onclick="showView('v-meetings')" id="ni-meetings"><span class="icon">ğŸ“‹</span>ì „ì²´ ë¯¸íŒ… í˜„í™©</div>
        <div class="nav-item" onclick="showView('v-users')" id="ni-users"><span class="icon">ğŸ‘¥</span>ì „ë¬¸ìœ„ì› í˜„í™©</div>
        <div class="nav-item" onclick="showView('v-accounts')" id="ni-accounts"><span class="icon">âš™ï¸</span>ê³„ì • ê´€ë¦¬</div>
      </nav>
      <div class="sidebar-bottom">
        <div class="sidebar-user" id="sidebar-user"></div>
        <button class="btn-logout" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </aside>

    <!-- ë©”ì¸ ì˜ì—­ -->
    <div class="main-area">
      <div class="topbar">
        <span class="topbar-title" id="topbar-title">ëŒ€ì‹œë³´ë“œ</span>
        <div style="display:flex;gap:10px">
          <button class="btn btn-blue btn-sm" onclick="openCreateMeeting()">+ ë¯¸íŒ… ë“±ë¡</button>
        </div>
      </div>
      <div class="content">

        <!-- ëŒ€ì‹œë³´ë“œ -->
        <div id="v-dash" class="view active">
          <div class="stat-grid">
            <div class="stat-card blue"><div class="num" id="d-open">-</div><div class="lbl">ëª¨ì§‘ì¤‘ ë¯¸íŒ…</div></div>
            <div class="stat-card orange"><div class="num" id="d-pending">-</div><div class="lbl">í™•ì • ëŒ€ê¸°</div><div class="sub">ì‹ ì† ì²˜ë¦¬ í•„ìš”</div></div>
            <div class="stat-card red"><div class="num" id="d-noprecall">-</div><div class="lbl">ì‚¬ì „ì½œ ë¯¸ê¸°ë¡</div></div>
            <div class="stat-card red"><div class="num" id="d-noresult">-</div><div class="lbl">ê²°ê³¼ ë¯¸ê¸°ë¡</div></div>
            <div class="stat-card blue"><div class="num" id="d-today">-</div><div class="lbl">ì˜¤ëŠ˜ ë¯¸íŒ…</div></div>
            <div class="stat-card blue"><div class="num" id="d-tomorrow">-</div><div class="lbl">ë‚´ì¼ ë¯¸íŒ…</div></div>
            <div class="stat-card green"><div class="num" id="d-weekassigned">-</div><div class="lbl">ì´ë²ˆ ì£¼ ë°°ì •</div></div>
          </div>

          <!-- í™•ì • ëŒ€ê¸° ëª©ë¡ -->
          <div class="card">
            <div class="card-header">
              <span class="card-title">âš¡ í™•ì • ëŒ€ê¸° ì¤‘ì¸ ë¯¸íŒ…</span>
              <button class="btn btn-outline btn-sm" onclick="showView('v-meetings')">ì „ì²´ í˜„í™© ë³´ê¸°</button>
            </div>
            <div id="dash-pending-list"><div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
          </div>

          <!-- ì‚¬ì „ì½œ/ê²°ê³¼ ë¯¸ê¸°ë¡ -->
          <div class="card" id="dash-norecord-card" style="display:none">
            <div class="card-header"><span class="card-title">âš ï¸ ê¸°ë¡ í•„ìš” í•­ëª©</span></div>
            <div id="dash-norecord-list"></div>
          </div>
        </div>

        <!-- ì „ì²´ ë¯¸íŒ… í˜„í™© -->
        <div id="v-meetings" class="view">
          <div class="filter-bar">
            <select id="f-status" onchange="loadMeetings()">
              <option value="">ì „ì²´ ìƒíƒœ</option>
              <option value="OPEN">ëª¨ì§‘ì¤‘</option>
              <option value="PENDING_CONFIRM">í™•ì • ëŒ€ê¸°</option>
              <option value="ASSIGNED">ë‹´ë‹¹ì í™•ì •</option>
              <option value="PRECALL_DONE">ì‚¬ì „ì½œ ì™„ë£Œ</option>
              <option value="MEETING_DONE">ë¯¸íŒ… ì™„ë£Œ</option>
              <option value="CANCELLED">ì·¨ì†Œ</option>
            </select>
            <select id="f-special" onchange="loadMeetings()">
              <option value="">ì „ì²´</option>
              <option value="noprecall">ì‚¬ì „ì½œ ë¯¸ê¸°ë¡ë§Œ</option>
              <option value="noresult">ê²°ê³¼ ë¯¸ê¸°ë¡ë§Œ</option>
            </select>
            <input type="date" id="f-from" onchange="loadMeetings()" placeholder="ì‹œì‘ì¼">
            <input type="date" id="f-to" onchange="loadMeetings()" placeholder="ì¢…ë£Œì¼">
            <button class="btn btn-ghost btn-sm" onclick="clearFilters()">í•„í„° ì´ˆê¸°í™”</button>
          </div>
          <div class="card" style="padding:0;overflow:hidden">
            <div id="meetings-table"><div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
          </div>
        </div>

        <!-- ì „ë¬¸ìœ„ì› í˜„í™© -->
        <div id="v-users" class="view">
          <div class="card" style="padding:0;overflow:hidden">
            <div style="padding:16px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
              <span class="card-title">ì „ë¬¸ìœ„ì› ì§„í–‰ í˜„í™©</span>
              <button class="btn btn-blue btn-sm" onclick="loadUsers()">ìƒˆë¡œ ê³ ì¹¨</button>
            </div>
            <div id="users-table"><div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
          </div>
        </div>

        <!-- ê³„ì • ê´€ë¦¬ -->
        <div id="v-accounts" class="view">
          <div class="card">
            <div class="card-header">
              <span class="card-title">ê³„ì • ê´€ë¦¬</span>
              <button class="btn btn-blue btn-sm" onclick="openCreateUser()">+ ê³„ì • ë“±ë¡</button>
            </div>
            <div id="accounts-table"><div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
          </div>
        </div>

      </div><!-- /content -->
    </div><!-- /main-area -->
  </div>
</div>

<!-- ëª¨ë‹¬: ë¯¸íŒ… ë“±ë¡/ìˆ˜ì • -->
<div class="modal-ov" id="m-meeting-form">
  <div class="modal">
    <div class="modal-hd"><span class="modal-title" id="mf-title">ë¯¸íŒ… ë“±ë¡</span><button class="modal-close" onclick="cm('m-meeting-form')">âœ•</button></div>
    <input type="hidden" id="mf-id">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0 16px">
      <div class="form-row" style="grid-column:1/-1"><label>ê³ ê°ëª… <span class="req">*</span></label><input type="text" class="fc" id="mf-customer" placeholder="ê³ ê°ì‚¬ëª… ë˜ëŠ” ê³ ê°ëª…"></div>
      <div class="form-row"><label>ë¯¸íŒ… ë‚ ì§œ <span class="req">*</span></label><input type="date" class="fc" id="mf-date"></div>
      <div class="form-row"><label>ë¯¸íŒ… ì‹œê°„ <span class="req">*</span></label><input type="time" class="fc" id="mf-time"></div>
      <div class="form-row"><label>ë°©ì‹ <span class="req">*</span></label>
        <select class="fc" id="mf-location"><option>ëŒ€ë©´</option><option>ë¹„ëŒ€ë©´</option><option>ì „í™”</option></select></div>
      <div class="form-row"><label>ìƒì„¸ ì¥ì†Œ</label><input type="text" class="fc" id="mf-location-detail" placeholder="ì£¼ì†Œ ë˜ëŠ” ì¥ì†Œëª…"></div>
      <div class="form-row" style="grid-column:1/-1"><label>ë¯¸íŒ… ì•ˆë‚´ ë‚´ìš©</label><textarea class="fc" id="mf-summary" rows="3" placeholder="ê³ ê° ì •ë³´, ë¯¸íŒ… ëª©ì  ë“±ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”"></textarea></div>
      <div class="form-row" style="grid-column:1/-1"><label>ì¤€ë¹„ì‚¬í•­ / íŠ¹ì´ì‚¬í•­</label><textarea class="fc" id="mf-note" rows="2"></textarea></div>
      <div class="form-row" style="grid-column:1/-1"><label>ê´€ë¦¬ì ë©”ëª¨</label><input type="text" class="fc" id="mf-memo" placeholder="ë‚´ë¶€ ë©”ëª¨ (ì „ë¬¸ìœ„ì›ì—ê²Œ ë¹„ê³µê°œ)"></div>
    </div>
    <div class="modal-ft">
      <button class="btn btn-ghost" onclick="cm('m-meeting-form')">ì·¨ì†Œ</button>
      <button class="btn btn-blue" onclick="saveMeeting()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- ëª¨ë‹¬: ë¯¸íŒ… ìƒì„¸ (ì‹ ì²­ì ëª©ë¡ + í™•ì •) -->
<div class="modal-ov" id="m-meeting-detail">
  <div class="modal wide">
    <div class="modal-hd"><span class="modal-title" id="md-title">ë¯¸íŒ… ìƒì„¸</span><button class="modal-close" onclick="cm('m-meeting-detail')">âœ•</button></div>
    <div id="md-body"><div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
    <div class="modal-ft">
      <button class="btn btn-ghost" onclick="cm('m-meeting-detail')">ë‹«ê¸°</button>
      <button class="btn btn-outline btn-sm" id="md-btn-edit" onclick="openEditMeeting()" style="display:none">ë¯¸íŒ… ìˆ˜ì •</button>
      <button class="btn btn-red btn-sm" id="md-btn-close" onclick="closeMeeting()" style="display:none">ëª¨ì§‘ ë§ˆê°</button>
    </div>
  </div>
</div>

<!-- ëª¨ë‹¬: ë‹´ë‹¹ì ë³€ê²½ ë©”ëª¨ -->
<div class="modal-ov" id="m-change-memo">
  <div class="modal" style="max-width:400px">
    <div class="modal-hd"><span class="modal-title">ë‹´ë‹¹ì ë³€ê²½ í™•ì¸</span><button class="modal-close" onclick="cm('m-change-memo')">âœ•</button></div>
    <p id="change-memo-msg" style="font-size:14px;margin-bottom:16px;color:#444"></p>
    <div class="form-row"><label>ë³€ê²½ ì‚¬ìœ  (ì„ íƒ)</label><input type="text" class="fc" id="change-memo-input" placeholder="ë³€ê²½ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”"></div>
    <div class="modal-ft">
      <button class="btn btn-ghost" onclick="cm('m-change-memo')">ì·¨ì†Œ</button>
      <button class="btn btn-blue" onclick="doChangeAssignee()">í™•ì • ë³€ê²½</button>
    </div>
  </div>
</div>

<!-- ëª¨ë‹¬: ê³„ì • ë“±ë¡ -->
<div class="modal-ov" id="m-user-form">
  <div class="modal" style="max-width:460px">
    <div class="modal-hd"><span class="modal-title">ê³„ì • ë“±ë¡</span><button class="modal-close" onclick="cm('m-user-form')">âœ•</button></div>
    <div class="form-row"><label>ì´ë¦„ <span class="req">*</span></label><input type="text" class="fc" id="uf-name" placeholder="ì „ë¬¸ìœ„ì› ì´ë¦„"></div>
    <div class="form-row"><label>ì•„ì´ë”” <span class="req">*</span></label><input type="text" class="fc" id="uf-id" placeholder="ë¡œê·¸ì¸ ì•„ì´ë”” (ì˜ë¬¸+ìˆ«ì)"></div>
    <div class="form-row"><label>íœ´ëŒ€í°ë²ˆí˜¸ <span class="req">*</span></label><input type="text" class="fc" id="uf-phone" placeholder="010-1234-5678"></div>
    <div class="form-row"><label>ì—­í• </label>
      <select class="fc" id="uf-role"><option value="expert">ì „ë¬¸ìœ„ì›</option><option value="admin">ê´€ë¦¬ì</option></select></div>
    <div class="form-row"><label>ë©”ëª¨</label><input type="text" class="fc" id="uf-memo" placeholder="ë‚´ë¶€ ë©”ëª¨ (ì„ íƒ)"></div>
    <div style="background:var(--sky);border-radius:8px;padding:12px;font-size:12px;color:var(--blue);margin-bottom:16px">
      ğŸ’¡ ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: <strong>ì´ë¦„ + íœ´ëŒ€í°ë²ˆí˜¸ ì „ì²´</strong><br>ì˜ˆ) í™ê¸¸ë™010-1234-5678
    </div>
    <div class="modal-ft">
      <button class="btn btn-ghost" onclick="cm('m-user-form')">ì·¨ì†Œ</button>
      <button class="btn btn-blue" onclick="createUser()">ë“±ë¡</button>
    </div>
  </div>
</div>

<!-- ëª¨ë‹¬: ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™” í™•ì¸ -->
<div class="modal-ov" id="m-reset-pw">
  <div class="modal" style="max-width:380px">
    <div class="modal-hd"><span class="modal-title">ë¹„ë°€ë²ˆí˜¸ ì´ˆê¸°í™”</span><button class="modal-close" onclick="cm('m-reset-pw')">âœ•</button></div>
    <p id="reset-pw-msg" style="font-size:14px;line-height:1.7;color:#444;margin-bottom:16px"></p>
    <div class="modal-ft">
      <button class="btn btn-ghost" onclick="cm('m-reset-pw')">ì·¨ì†Œ</button>
      <button class="btn btn-orange" onclick="doResetPassword()">ì´ˆê¸°í™”</button>
    </div>
  </div>
</div>

<!-- ëª¨ë‹¬: ê´€ë¦¬ì ì²« ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
<div class="modal-ov" id="m-changepw">
  <div class="modal" style="max-width:440px">
    <div class="modal-hd"><span class="modal-title">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ í•„ìš”</span></div>
    <p style="font-size:13px;color:var(--gray);margin-bottom:20px">ì²« ë¡œê·¸ì¸ì…ë‹ˆë‹¤. ë³´ì•ˆì„ ìœ„í•´ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ ì£¼ì„¸ìš”.</p>
    <div class="auth-err" id="adm-changepw-err"></div>
    <div class="form-row"><label>í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ <span class="req">*</span></label><input type="password" class="fc" id="acp-cur" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ (ì´ˆê¸°: ì´ë¦„+íœ´ëŒ€í°ë²ˆí˜¸)"></div>
    <div class="form-row"><label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ <span class="req">*</span> <span style="font-size:11px;color:var(--gray);font-weight:400">(8ì ì´ìƒ, íœ´ëŒ€í°ë²ˆí˜¸ ë¶ˆê°€)</span></label><input type="password" class="fc" id="acp-new" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸"></div>
    <div class="form-row"><label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ <span class="req">*</span></label><input type="password" class="fc" id="acp-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥"></div>
    <div class="modal-ft">
      <button class="btn btn-blue" onclick="doAdminChangePw()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
    </div>
  </div>
</div>

<script>
// â”€â”€ ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const API_URL = 'https://script.google.com/macros/s/AKfycbxSlyEOv68m-NPutmkx9vP3MExIw1sWo1hx22Z4JWFobQTFKYNhJKhnNSi-3VwaUsxROQ/exec';

// â”€â”€ ì „ì—­ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let S = { token:null, user:null, curMid:null, curAppId:null, curUserId:null, pendingConfirmApp:null };

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.onload = () => {
  const t=localStorage.getItem('adm_token'), u=localStorage.getItem('adm_user');
  if (t && u) {
    S.token=t; S.user=JSON.parse(u);
    if (S.user.role !== 'admin') { alert('ê´€ë¦¬ì ê³„ì •ì´ ì•„ë‹™ë‹ˆë‹¤.'); showPage('page-login'); return; }
    showPage('page-main'); initMain();
    if (S.user.mustChangePassword === true || S.user.mustChangePassword === 'true') {
      om('m-changepw');
    }
  } else showPage('page-login');
  document.getElementById('inp-pw').addEventListener('keydown', e=>{ if(e.key==='Enter') doLogin(); });
  document.getElementById('acp-confirm').addEventListener('keydown', e=>{ if(e.key==='Enter') doAdminChangePw(); });
};

function showPage(id){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('active')); document.getElementById(id).classList.add('active'); }
function showView(id){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  const map={'v-dash':'ni-dash','v-meetings':'ni-meetings','v-users':'ni-users','v-accounts':'ni-accounts'};
  const titles={'v-dash':'ëŒ€ì‹œë³´ë“œ','v-meetings':'ì „ì²´ ë¯¸íŒ… í˜„í™©','v-users':'ì „ë¬¸ìœ„ì› í˜„í™©','v-accounts':'ê³„ì • ê´€ë¦¬'};
  if(map[id]) document.getElementById(map[id]).classList.add('active');
  document.getElementById('topbar-title').textContent=titles[id]||'';
  if(id==='v-meetings') loadMeetings();
  if(id==='v-users')    loadUsers();
  if(id==='v-accounts') loadAccounts();
}

// â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(action, body={}) {
  try {
    const r=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action,token:S.token,...body})});
    const data=await r.json();
    // ì„¸ì…˜ ë§Œë£Œ ê°ì§€ â†’ ìë™ ë¡œê·¸ì•„ì›ƒ
    if (!data.success && data.message && data.message.includes('ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤')) {
      localStorage.removeItem('adm_token');
      localStorage.removeItem('adm_user');
      S.token=null; S.user=null;
      showPage('page-login');
      showToast('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.', 'error');
    }
    return data;
  } catch(e){ return {success:false,message:'ì„œë²„ ì—°ê²° ì˜¤ë¥˜. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.'}; }
}

// â”€â”€ ë¡œê·¸ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doLogin(){
  const loginId=document.getElementById('inp-id').value.trim(), password=document.getElementById('inp-pw').value;
  const btn=document.getElementById('btn-login'), err=document.getElementById('login-err');
  if(!loginId||!password){ showErr(err,'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
  err.style.display='none'; btn.textContent='ë¡œê·¸ì¸ ì¤‘...'; btn.disabled=true;
  const r=await api('login',{loginId,password});
  btn.textContent='ë¡œê·¸ì¸'; btn.disabled=false;
  if(!r.success){ showErr(err,r.message); return; }
  if(r.user.role!=='admin'){ showErr(err,'ê´€ë¦¬ì ê³„ì •ì´ ì•„ë‹™ë‹ˆë‹¤.'); return; }
  S.token=r.token; S.user=r.user;
  localStorage.setItem('adm_token',r.token); localStorage.setItem('adm_user',JSON.stringify(r.user));
  showPage('page-main');
  if (r.mustChangePassword) {
    initMain();
    om('m-changepw');
  } else {
    initMain();
  }
}

async function doLogout(){
  await api('logout');
  localStorage.removeItem('adm_token'); localStorage.removeItem('adm_user');
  S.token=null; S.user=null; showPage('page-login');
}

async function initMain(){
  document.getElementById('sidebar-user').textContent='ğŸ‘¤ '+S.user.displayName;
  loadDashboard();
}

// â”€â”€ ëŒ€ì‹œë³´ë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadDashboard(){
  const [dr, mr] = await Promise.all([api('adminGetDashboard'), api('adminGetMeetings',{filterStatus:'PENDING_CONFIRM'})]);
  if(dr.success){
    document.getElementById('d-open').textContent=dr.openCount||0;
    document.getElementById('d-pending').textContent=dr.pendingCount||0;
    document.getElementById('d-noprecall').textContent=dr.noPreCallCount||0;
    document.getElementById('d-noresult').textContent=dr.noResultCount||0;
    document.getElementById('d-today').textContent=dr.todayCount||0;
    document.getElementById('d-tomorrow').textContent=dr.tomorrowCount||0;
    document.getElementById('d-weekassigned').textContent=dr.weekAssigned||0;
  }
  const pendingEl=document.getElementById('dash-pending-list');
  if(mr.success && mr.list.length>0){
    pendingEl.innerHTML=`<table class="tbl"><thead><tr><th>ê³ ê°ëª…</th><th>ë¯¸íŒ… ì¼ì‹œ</th><th>ë°©ì‹</th><th>ì‹ ì²­ì</th><th>ì²˜ë¦¬</th></tr></thead><tbody>`+
      mr.list.map(m=>`<tr>
        <td><strong>${m.customerName}</strong></td>
        <td>${m.meetingDate} ${m.meetingTime}</td>
        <td>${m.locationType}</td>
        <td>${m.applicationCount}ëª…</td>
        <td><button class="btn btn-orange btn-sm" onclick="openMeetingDetail('${m.meetingId}')">ì‹ ì²­ì í™•ì¸ Â· í™•ì •</button></td>
      </tr>`).join('')+`</tbody></table>`;
  } else pendingEl.innerHTML=`<div class="empty-state"><div class="icon">âœ…</div><p>í™•ì • ëŒ€ê¸° ì¤‘ì¸ ë¯¸íŒ…ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;

  // ê¸°ë¡ í•„ìš” ì¹´ë“œ ì´ˆê¸°í™” í›„ ì¡°ê±´ë¶€ í‘œì‹œ
  document.getElementById('dash-norecord-card').style.display='none';
  const [npr, nrr] = await Promise.all([api('adminGetMeetings',{filterNoPreCall:true}), api('adminGetMeetings',{filterNoResult:true})]);
  const np=npr.success?npr.list:[], nr=nrr.success?nrr.list:[];
  if(np.length||nr.length){
    document.getElementById('dash-norecord-card').style.display='block';
    let html='';
    np.slice(0,5).forEach(m=>{ html+=`<div style="padding:10px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
      <div><strong>${m.customerName}</strong> &nbsp;<span class="badge badge-warn">ì‚¬ì „ì½œ ë¯¸ê¸°ë¡</span><br><span style="font-size:12px;color:var(--gray)">${m.meetingDate} Â· ${m.assignedUserName}</span></div>
      <button class="btn btn-ghost btn-sm" onclick="openMeetingDetail('${m.meetingId}')">ìƒì„¸</button></div>`; });
    nr.slice(0,5).forEach(m=>{ html+=`<div style="padding:10px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
      <div><strong>${m.customerName}</strong> &nbsp;<span class="badge badge-cancelled">ê²°ê³¼ ë¯¸ê¸°ë¡</span><br><span style="font-size:12px;color:var(--gray)">${m.meetingDate} Â· ${m.assignedUserName}</span></div>
      <button class="btn btn-ghost btn-sm" onclick="openMeetingDetail('${m.meetingId}')">ìƒì„¸</button></div>`; });
    document.getElementById('dash-norecord-list').innerHTML=html;
  }
}

// â”€â”€ ë¯¸íŒ… ëª©ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadMeetings(){
  const el=document.getElementById('meetings-table');
  el.innerHTML='<div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
  const fs=document.getElementById('f-status').value, fsp=document.getElementById('f-special').value;
  const ff=document.getElementById('f-from').value, ft=document.getElementById('f-to').value;
  const body={ filterStatus:fs, filterNoPreCall:fsp==='noprecall', filterNoResult:fsp==='noresult', dateFrom:ff, dateTo:ft };
  const r=await api('adminGetMeetings',body);
  if(!r.success){ el.innerHTML=`<div class="empty-state"><p>${r.message}</p></div>`; return; }
  if(!r.list.length){ el.innerHTML=`<div class="empty-state"><div class="icon">ğŸ“­</div><p>ì¡°ê±´ì— ë§ëŠ” ë¯¸íŒ…ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`; return; }
  el.innerHTML=`<table class="tbl"><thead><tr><th>ê³ ê°ëª…</th><th>ë¯¸íŒ… ì¼ì‹œ</th><th>ë°©ì‹</th><th>ìƒíƒœ</th><th>ë‹´ë‹¹ì</th><th>ì‹ ì²­ì</th><th>ì‚¬ì „ì½œ</th><th>ê²°ê³¼</th><th>ì²˜ë¦¬</th></tr></thead><tbody>`+
    r.list.map(m=>`<tr>
      <td><strong>${m.customerName}</strong>${m.adminMemo?`<br><span style="font-size:11px;color:var(--gray)">${m.adminMemo}</span>`:''}</td>
      <td style="white-space:nowrap">${m.meetingDate}<br><span style="font-size:12px;color:var(--gray)">${m.meetingTime}</span></td>
      <td>${m.locationType}</td>
      <td><span class="badge ${stClass(m.status)}">${stTxt(m.status)}</span></td>
      <td>${m.assignedUserName||'<span style="color:#ccc">ë¯¸ì •</span>'}</td>
      <td style="text-align:center">${m.applicationCount}</td>
      <td style="text-align:center">${m.hasPreCall?'<span style="color:var(--green)">âœ“</span>':'<span style="color:#ccc">-</span>'}</td>
      <td style="text-align:center">${m.hasResult?'<span style="color:var(--green)">âœ“</span>':'<span style="color:#ccc">-</span>'}</td>
      <td><button class="btn btn-ghost btn-sm" onclick="openMeetingDetail('${m.meetingId}')">ìƒì„¸</button></td>
    </tr>`).join('')+`</tbody></table>`;
}

function clearFilters(){
  ['f-status','f-special','f-from','f-to'].forEach(id=>document.getElementById(id).value='');
  loadMeetings();
}

// â”€â”€ ë¯¸íŒ… ìƒì„¸ (ì‹ ì²­ì í™•ì • í¬í•¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentMeetingData = null; // Fix #3: ìˆ˜ì • í¼ ê¸°ì¡´ ë°ì´í„° ì±„ìš°ê¸°ìš©

async function openMeetingDetail(mid){
  S.curMid=mid;
  const body=document.getElementById('md-body');
  body.innerHTML='<div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
  om('m-meeting-detail');
  const r=await api('adminGetMeetingDetail',{meetingId:mid});
  if(!r.success){ body.innerHTML=`<p style="color:var(--red)">${r.message}</p>`; return; }
  const m=r.meeting;
  currentMeetingData = m; // Fix #3: ì „ì—­ ë³´ê´€
  document.getElementById('md-title').textContent=m.customerName+' ë¯¸íŒ…';
  document.getElementById('md-btn-edit').style.display='inline-flex';
  document.getElementById('md-btn-close').style.display=(m.status==='OPEN'||m.status==='PENDING_CONFIRM')?'inline-flex':'none';

  // ì‹ ì²­ì ëª©ë¡
  let applicantsHtml='<div class="section-title">ì‹ ì²­ì ëª©ë¡ (ì‹ ì²­ ìˆœì„œ ê¸°ì¤€)</div>';
  if(!r.applicants||!r.applicants.length){
    applicantsHtml+='<p style="color:var(--gray);font-size:13px;padding:12px 0">ì•„ì§ ì‹ ì²­ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
  } else {
    // Fix #8: userName íŠ¹ìˆ˜ë¬¸ì â†’ data ì†ì„±ìœ¼ë¡œ ì „ë‹¬
    applicantsHtml+=r.applicants.map(a=>{
      const safeUserName = a.userName.replace(/"/g,'&quot;').replace(/'/g,'&#39;');
      const actionBtn = a.status!=='ASSIGNED'
        ? `<button class="btn btn-green btn-sm" data-app-id="${a.applicationId}" data-user-name="${safeUserName}" onclick="confirmAssignee(this.dataset.appId,this.dataset.userName)">í™•ì •</button>`
        : `<button class="btn btn-outline btn-sm" data-app-id="${a.applicationId}" data-user-name="${safeUserName}" onclick="openChangeMemo(this.dataset.appId,this.dataset.userName)">ë‹´ë‹¹ì ë³€ê²½</button>`;
      return `
      <div class="applicant-item ${a.status==='ASSIGNED'?'assigned':a.status==='RESERVE'?'reserve':''}">
        <div class="ai-left">
          <div class="ai-no ${a.status==='RESERVE'?'reserve':''}">${a.orderNo}</div>
          <div>
            <div class="ai-name">${a.userName} ${a.status==='ASSIGNED'?'<span class="badge badge-assigned">ë‹´ë‹¹ì</span>':a.status==='RESERVE'?'<span class="badge badge-cancelled">ì˜ˆë¹„</span>':''}</div>
            <div class="ai-time">ì‹ ì²­: ${a.appliedAt}</div>
            ${a.isWeeklyAssigned?'<div class="ai-warn">âš ï¸ ì´ë²ˆ ì£¼ ë‹¤ë¥¸ ë¯¸íŒ… ë‹´ë‹¹ì í™•ì • ì´ë ¥ ìˆìŒ</div>':''}
          </div>
        </div>
        <div style="display:flex;gap:6px;flex-shrink:0">${actionBtn}</div>
      </div>`;
    }).join('');
  }

  // ë¯¸íŒ… ê¸°ë³¸ì •ë³´
  const infoHtml=`
    <div class="detail-row"><span class="detail-lbl">ê³ ê°ëª…</span><span class="detail-val">${m.customerName}</span></div>
    <div class="detail-row"><span class="detail-lbl">ì¼ì‹œ</span><span class="detail-val">${m.meetingDate} (${m.weekday}) ${m.meetingTime}</span></div>
    <div class="detail-row"><span class="detail-lbl">ë°©ì‹</span><span class="detail-val">${m.locationType}${m.locationDetail?' Â· '+m.locationDetail:''}</span></div>
    <div class="detail-row"><span class="detail-lbl">ìƒíƒœ</span><span class="detail-val"><span class="badge ${stClass(m.status)}">${stTxt(m.status)}</span></span></div>
    <div class="detail-row"><span class="detail-lbl">ë‹´ë‹¹ì</span><span class="detail-val">${m.assignedUserName||'ë¯¸ì •'}</span></div>
    <div class="detail-row"><span class="detail-lbl">ì‹ ì²­ì ìˆ˜</span><span class="detail-val">${m.applicationCount}ëª…</span></div>
    ${m.meetingSummary?`<div class="detail-row"><span class="detail-lbl">ì•ˆë‚´ë‚´ìš©</span><span class="detail-val" style="white-space:pre-wrap">${m.meetingSummary}</span></div>`:''}
    ${m.preparationNote?`<div class="detail-row"><span class="detail-lbl">ì¤€ë¹„ì‚¬í•­</span><span class="detail-val" style="white-space:pre-wrap">${m.preparationNote}</span></div>`:''}
    ${m.adminMemo?`<div class="detail-row"><span class="detail-lbl">ê´€ë¦¬ì ë©”ëª¨</span><span class="detail-val">${m.adminMemo}</span></div>`:''}`;

  // ì‚¬ì „ì½œ
  const precallHtml=r.preCall?`<div class="section-title" style="margin-top:20px">ì‚¬ì „ì½œ ê¸°ë¡</div>
    <div style="background:var(--sky);border-radius:8px;padding:12px;font-size:13px">
      <strong>${r.preCall.callStatus}</strong> Â· ${r.preCall.callAt}<br>
      ${r.preCall.callNote}<br>
      ë¯¸íŒ… í™•ì •: ${r.preCall.meetingConfirmYn==='Y'?'âœ… ì˜ˆ':'âŒ ì•„ë‹ˆì˜¤'}
    </div>`:`<div class="section-title" style="margin-top:20px">ì‚¬ì „ì½œ ê¸°ë¡</div><p style="color:var(--gray);font-size:13px">ë¯¸ê¸°ë¡</p>`;

  // ê²°ê³¼
  const resultHtml=r.result?`<div class="section-title" style="margin-top:20px">ë¯¸íŒ… ê²°ê³¼</div>
    <div style="background:var(--green-light);border-radius:8px;padding:12px;font-size:13px">
      <strong>${r.result.meetingResultStatus}</strong> Â· ${r.result.actualMeetingAt}<br>
      ${r.result.resultSummary}<br>
      ${r.result.followUpPlan?'í›„ì†: '+r.result.followUpPlan:''}
    </div>`:`<div class="section-title" style="margin-top:20px">ë¯¸íŒ… ê²°ê³¼</div><p style="color:var(--gray);font-size:13px">ë¯¸ê¸°ë¡</p>`;

  // ì´ë ¥ ë¡œê·¸
  let logHtml='<div class="section-title" style="margin-top:20px">ì „ì²´ ì´ë ¥</div>';
  if(r.logs&&r.logs.length){
    logHtml+=r.logs.map(l=>`<div class="log-item"><span class="log-time">${l.timestamp}</span><div><div class="log-actor">${l.actorName}</div><div class="log-msg">${l.summary}</div></div></div>`).join('');
  } else logHtml+='<p style="color:var(--gray);font-size:13px">ì´ë ¥ ì—†ìŒ</p>';

  body.innerHTML=`
    <div class="section-title">ë¯¸íŒ… ì •ë³´</div>${infoHtml}
    <hr style="border:none;border-top:1px solid var(--border);margin:16px 0">
    ${applicantsHtml}${precallHtml}${resultHtml}${logHtml}`;
}

// â”€â”€ ë‹´ë‹¹ì í™•ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function confirmAssignee(appId, userName){
  if(!confirm(`"${userName}"ë‹˜ì„ ë‹´ë‹¹ìë¡œ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  const r=await api('adminConfirmAssignee',{meetingId:S.curMid, applicationId:appId});
  if(!r.success){ showToast(r.message,'error'); return; }
  showToast(r.message,'success');
  openMeetingDetail(S.curMid);
  loadDashboard();
}

// â”€â”€ ë‹´ë‹¹ì ë³€ê²½ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openChangeMemo(appId, userName){
  S.pendingConfirmApp={appId, userName};
  document.getElementById('change-memo-msg').textContent=`"${userName}"ë‹˜ìœ¼ë¡œ ë‹´ë‹¹ìë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
  document.getElementById('change-memo-input').value='';
  om('m-change-memo');
}
async function doChangeAssignee(){
  const memo=document.getElementById('change-memo-input').value;
  const r=await api('adminChangeAssignee',{meetingId:S.curMid, applicationId:S.pendingConfirmApp.appId, changeMemo:memo});
  cm('m-change-memo');
  if(!r.success){ showToast(r.message,'error'); return; }
  showToast('ë‹´ë‹¹ìê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.','success');
  openMeetingDetail(S.curMid); loadDashboard();
}

// â”€â”€ ëª¨ì§‘ ë§ˆê° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function closeMeeting(){
  if(!confirm('ì´ ë¯¸íŒ…ì„ ë§ˆê° ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  const r=await api('adminCloseMeeting',{meetingId:S.curMid});
  if(!r.success){ showToast(r.message,'error'); return; }
  cm('m-meeting-detail'); showToast('ë§ˆê° ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.','success');
  loadDashboard(); if(document.getElementById('v-meetings').classList.contains('active')) loadMeetings();
}

// â”€â”€ ë¯¸íŒ… ë“±ë¡/ìˆ˜ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openCreateMeeting(){
  document.getElementById('mf-id').value='';
  document.getElementById('mf-title').textContent='ë¯¸íŒ… ë“±ë¡';
  ['mf-customer','mf-location-detail','mf-summary','mf-note','mf-memo'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('mf-date').value='';
  document.getElementById('mf-time').value='';
  document.getElementById('mf-location').value='ëŒ€ë©´';
  om('m-meeting-form');
}
function openEditMeeting(){
  cm('m-meeting-detail');
  const m = currentMeetingData;
  if (!m) { showToast('ë¯¸íŒ… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error'); return; }
  document.getElementById('mf-id').value = S.curMid;
  document.getElementById('mf-title').textContent = 'ë¯¸íŒ… ìˆ˜ì •';
  document.getElementById('mf-customer').value = m.customerName || '';
  document.getElementById('mf-date').value = m.meetingDate || '';
  document.getElementById('mf-time').value = m.meetingTime || '';
  document.getElementById('mf-location').value = m.locationType || 'ëŒ€ë©´';
  document.getElementById('mf-location-detail').value = m.locationDetail || '';
  document.getElementById('mf-summary').value = m.meetingSummary || '';
  document.getElementById('mf-note').value = m.preparationNote || '';
  document.getElementById('mf-memo').value = m.adminMemo || '';
  om('m-meeting-form');
}
async function saveMeeting(){
  const id=document.getElementById('mf-id').value;
  const body={
    customerName:document.getElementById('mf-customer').value.trim(),
    meetingDate:document.getElementById('mf-date').value,
    meetingTime:document.getElementById('mf-time').value,
    locationType:document.getElementById('mf-location').value,
    locationDetail:document.getElementById('mf-location-detail').value.trim(),
    meetingSummary:document.getElementById('mf-summary').value.trim(),
    preparationNote:document.getElementById('mf-note').value.trim(),
    adminMemo:document.getElementById('mf-memo').value.trim()
  };
  if(!body.customerName||!body.meetingDate||!body.meetingTime){ showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.','error'); return; }

  // Fix #13: ì €ì¥ ë²„íŠ¼ ì¤‘ë³µ í´ë¦­ ë°©ì§€
  const saveBtn = document.querySelector('#m-meeting-form .btn-blue');
  saveBtn.disabled=true; saveBtn.textContent='ì €ì¥ ì¤‘...';

  // Fix #2: ë¹„ìš´ì˜ ìš”ì¼ weekdayWarning ì²˜ë¦¬
  const r=await api(id?'adminUpdateMeeting':'adminCreateMeeting',{...body, meetingId:id||undefined});

  if(!r.success){
    saveBtn.disabled=false; saveBtn.textContent='ì €ì¥';
    if(r.weekdayWarning){
      if(confirm(r.message+'\n\nê·¸ë˜ë„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
        saveBtn.disabled=true; saveBtn.textContent='ì €ì¥ ì¤‘...';
        const r2=await api('adminCreateMeeting',{...body, forceCreate:true});
        saveBtn.disabled=false; saveBtn.textContent='ì €ì¥';
        if(!r2.success){ showToast(r2.message,'error'); return; }
        cm('m-meeting-form'); showToast(r2.message,'success');
        loadDashboard(); if(document.getElementById('v-meetings').classList.contains('active')) loadMeetings();
      }
    } else {
      showToast(r.message,'error');
    }
    return;
  }

  saveBtn.disabled=false; saveBtn.textContent='ì €ì¥';
  cm('m-meeting-form'); showToast(r.message,'success');
  loadDashboard(); if(document.getElementById('v-meetings').classList.contains('active')) loadMeetings();
}

// â”€â”€ ì „ë¬¸ìœ„ì› í˜„í™© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadUsers(){
  const el=document.getElementById('users-table');
  el.innerHTML='<div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
  const r=await api('adminGetUsers');
  if(!r.success){ el.innerHTML=`<div class="empty-state"><p>${r.message}</p></div>`; return; }
  el.innerHTML=`<table class="tbl"><thead><tr><th>ì´ë¦„</th><th>ì•„ì´ë””</th><th>ì´ë²ˆì£¼ í™•ì •</th><th>ì´ ë°°ì •</th><th>ìµœê·¼ ë¡œê·¸ì¸</th><th>ìƒíƒœ</th></tr></thead><tbody>`+
    r.list.map(u=>`<tr>
      <td><strong>${u.displayName}</strong></td>
      <td style="color:var(--gray)">${u.loginId}</td>
      <td style="text-align:center">${u.thisWeekAssigned?'<span class="badge badge-assigned">í™•ì •ë¨</span>':'<span style="color:#ccc">-</span>'}</td>
      <td style="text-align:center">${u.totalAssigned}</td>
      <td style="font-size:12px;color:var(--gray)">${u.lastLoginAt||'-'}</td>
      <td><span class="badge ${u.status==='active'?'badge-assigned':'badge-cancelled'}">${u.status==='active'?'í™œì„±':'ë¹„í™œì„±'}</span></td>
    </tr>`).join('')+`</tbody></table>`;
}

// â”€â”€ ê³„ì • ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAccounts(){
  const el=document.getElementById('accounts-table');
  el.innerHTML='<div class="loading"><span class="spinner"></span>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
  const r=await api('adminGetUsers');
  if(!r.success){ el.innerHTML=`<div class="empty-state"><p>${r.message}</p></div>`; return; }
  el.innerHTML=`<table class="tbl"><thead><tr><th>ì´ë¦„</th><th>ì•„ì´ë””</th><th>ì—­í• </th><th>íœ´ëŒ€í°</th><th>ìƒíƒœ</th><th>ì²«ë¡œê·¸ì¸</th><th>ê´€ë¦¬</th></tr></thead><tbody>`+
    r.list.map(u=>`<tr>
      <td><strong>${u.displayName}</strong></td>
      <td style="color:var(--gray)">${u.loginId}</td>
      <td>${u.role==='admin'?'<span class="badge badge-open">ê´€ë¦¬ì</span>':'ì „ë¬¸ìœ„ì›'}</td>
      <td style="font-size:12px">${u.phone||'-'}</td>
      <td><span class="badge ${u.status==='active'?'badge-assigned':'badge-cancelled'}">${u.status==='active'?'í™œì„±':'ë¹„í™œì„±'}</span></td>
      <td style="text-align:center">${u.mustChangePassword==='Y'?'<span style="color:var(--orange)">ë³€ê²½í•„ìš”</span>':'ì™„ë£Œ'}</td>
      <td><div class="action-btns">
        <button class="btn btn-sm ${u.status==='active'?'btn-ghost':'btn-green'}" onclick="toggleUser('${u.userId}','${u.displayName}',${u.status!=='active'})">${u.status==='active'?'ë¹„í™œì„±í™”':'í™œì„±í™”'}</button>
        <button class="btn btn-orange btn-sm" onclick="openResetPw('${u.userId}','${u.displayName}')">ë¹„ë²ˆ ì´ˆê¸°í™”</button>
      </div></td>
    </tr>`).join('')+`</tbody></table>`;
}

function openCreateUser(){
  ['uf-name','uf-id','uf-phone','uf-memo'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('uf-role').value='expert';
  om('m-user-form');
}
async function createUser(){
  const body={ displayName:document.getElementById('uf-name').value.trim(), loginId:document.getElementById('uf-id').value.trim(), phone:document.getElementById('uf-phone').value.trim(), role:document.getElementById('uf-role').value, memo:document.getElementById('uf-memo').value.trim() };
  if(!body.displayName||!body.loginId||!body.phone){ showToast('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.','error'); return; }
  const saveBtn=document.querySelector('#m-user-form .btn-blue');
  saveBtn.disabled=true; saveBtn.textContent='ë“±ë¡ ì¤‘...';
  const r=await api('adminCreateUser',body);
  saveBtn.disabled=false; saveBtn.textContent='ë“±ë¡';
  if(!r.success){ showToast(r.message,'error'); return; }
  cm('m-user-form'); showToast(r.message,'success');
  loadAccounts();
}

async function toggleUser(userId, name, activate){
  if(!confirm(`"${name}"ë‹˜ ê³„ì •ì„ ${activate?'í™œì„±í™”':'ë¹„í™œì„±í™”'}í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  const r=await api('adminToggleUser',{userId, activate});
  if(!r.success){ showToast(r.message,'error'); return; }
  showToast(r.message,'success'); loadAccounts();
}

function openResetPw(userId, name){
  S.curUserId=userId;
  document.getElementById('reset-pw-msg').textContent=`"${name}"ë‹˜ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: ì´ë¦„ + íœ´ëŒ€í°ë²ˆí˜¸ ì „ì²´`;
  om('m-reset-pw');
}
async function doResetPassword(){
  const r=await api('adminResetPassword',{userId:S.curUserId});
  cm('m-reset-pw');
  if(!r.success){ showToast(r.message,'error'); return; }
  showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸: '+r.initPassword,'success');
}

// â”€â”€ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ì²« ë¡œê·¸ì¸) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function doAdminChangePw(){
  const cur=document.getElementById('acp-cur').value;
  const nw=document.getElementById('acp-new').value;
  const conf=document.getElementById('acp-confirm').value;
  const err=document.getElementById('adm-changepw-err');
  err.style.display='none';
  if(!cur||!nw||!conf){ showErr(err,'ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.'); return; }
  if(nw!==conf){ showErr(err,'ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
  if(nw.length<8){ showErr(err,'ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }
  const saveBtn=document.querySelector('#m-changepw .btn-blue');
  saveBtn.disabled=true; saveBtn.textContent='ë³€ê²½ ì¤‘...';
  const r=await api('changePassword',{currentPassword:cur,newPassword:nw});
  saveBtn.disabled=false; saveBtn.textContent='ë¹„ë°€ë²ˆí˜¸ ë³€ê²½';
  if(!r.success){ showErr(err,r.message); return; }
  S.user.mustChangePassword=false;
  localStorage.setItem('adm_user',JSON.stringify(S.user));
  cm('m-changepw');
  showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.','success');
}

// â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function om(id){ document.getElementById(id).classList.add('open'); }
function cm(id){ document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-ov').forEach(el=>el.addEventListener('click',function(e){ if(e.target===this) this.classList.remove('open'); }));
function showToast(msg,type=''){
  const t=document.getElementById('toast'); t.textContent=msg; t.className='show '+type;
  clearTimeout(t._t); t._t=setTimeout(()=>t.className='',4000);
}
function showErr(el,msg){ el.textContent=msg; el.style.display='block'; }
function stTxt(s){ return {OPEN:'ëª¨ì§‘ì¤‘',PENDING_CONFIRM:'í™•ì • ëŒ€ê¸°',ASSIGNED:'ë‹´ë‹¹ì í™•ì •',PRECALL_DONE:'ì‚¬ì „ì½œ ì™„ë£Œ',MEETING_DONE:'ë¯¸íŒ… ì™„ë£Œ',CANCELLED:'ì·¨ì†Œ'}[s]||s; }
function stClass(s){ return {OPEN:'badge-open',PENDING_CONFIRM:'badge-pending',ASSIGNED:'badge-assigned',PRECALL_DONE:'badge-precall',MEETING_DONE:'badge-done',CANCELLED:'badge-cancelled'}[s]||''; }
</script>
</body>
</html>
